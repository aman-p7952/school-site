<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Home Page</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9"
      crossorigin="anonymous"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script>
      function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== "") {
          const cookies = document.cookie.split(";");
          for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) === name + "=") {
              cookieValue = decodeURIComponent(
                cookie.substring(name.length + 1)
              );
              break;
            }
          }
        }
        return cookieValue;
      }
      $(document).ready(function () {
        $("#button").click(function () {
          $.ajax({
            type: "POST",
            url: "/fee_details",
            data: {
              student_id: $("#input").val(),
            },
            headers: {
              //"X-Requested-With": "XMLHttpRequest",
              "X-CSRFToken": getCookie("csrftoken"),
            },
            success: function (data, status) {
              //alert("Data: " + data + "\nStatus: " + status);
              if (status == "success") {
                console.log(data);
                if (data["status"][0] == 1) {
                  $("#1").css("background", "green");
                }
                if (data["status"][1] == 1) {
                  $("#2").css("background", "green");
                }
                if (data["status"][2] == 1) {
                  $("#3").css("background", "green");
                }
                if (data["status"][3] == 1) {
                  $("#4").css("background", "green");
                }
                if (data["status"][4] == 1) {
                  $("#5").css("background", "green");
                }
                if (data["status"][5] == 1) {
                  $("#6").css("background", "green");
                }
                if (data["status"][6] == 1) {
                  $("#7").css("background", "green");
                }
                if (data["status"][7] == 1) {
                  $("#8").css("background", "green");
                }
                if (data["status"][8] == 1) {
                  $("#9").css("background", "green");
                }
                if (data["status"][9] == 1) {
                  $("#10").css("background", "green");
                }
                if (data["status"][10] == 1) {
                  $("#11").css("background", "green");
                }
                if (data["status"][11] == 1) {
                  $("#12").css("background", "green");
                }
                $("#payment").css("visibility", "visible");
                $("#months").attr("max", data["payable"]);
              }
            },
          });
        });
        $("#pay_button").click(function () {
          $.ajax({
            type: "POST",
            url: "/fee_paid",
            data: {
              student_id: $("#input").val(),
              months: $("#months").val(),
            },
            headers: {
              //"X-Requested-With": "XMLHttpRequest",
              "X-CSRFToken": getCookie("csrftoken"),
            },
            success: function (data, status) {
              //alert("Data: " + data + "\nStatus: " + status);
              if (status == "success") {
                console.log(data);
                if (data["status"][0] == 1) {
                  $("#1").css("background", "green");
                }
                if (data["status"][1] == 1) {
                  $("#2").css("background", "green");
                }
                if (data["status"][2] == 1) {
                  $("#3").css("background", "green");
                }
                if (data["status"][3] == 1) {
                  $("#4").css("background", "green");
                }
                if (data["status"][4] == 1) {
                  $("#5").css("background", "green");
                }
                if (data["status"][5] == 1) {
                  $("#6").css("background", "green");
                }
                if (data["status"][6] == 1) {
                  $("#7").css("background", "green");
                }
                if (data["status"][7] == 1) {
                  $("#8").css("background", "green");
                }
                if (data["status"][8] == 1) {
                  $("#9").css("background", "green");
                }
                if (data["status"][9] == 1) {
                  $("#10").css("background", "green");
                }
                if (data["status"][10] == 1) {
                  $("#11").css("background", "green");
                }
                if (data["status"][11] == 1) {
                  $("#12").css("background", "green");
                }
                $("#paid").css("visibility", "visible");
                $("#months").attr("max", data["payable"]);
                $("#months").prop("value", "0");
              }
            },
          });
        });
      });
    </script>
  </head>
  <body>
    <div class="border-primary">
      <div class="d-flex card bg-dark text-white">
        <div class="row">
          <div class="col">Enter student Id:</div>
          <div class="col">
            <input name="student_id" id="input" />
          </div>
          <div class="col">
            <div class="d-grid gap-2">
              <button type="button" name="" id="button" class="btn btn-primary">
                GO
              </button>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-1"><div class=" d-flex justify-content-center rounded w-100" id="1">APR</div></div>
          <div class="col-1"><div class=" d-flex justify-content-center rounded w-100" id="2">MAY</div></div>
          <div class="col-1"><div class=" d-flex justify-content-center rounded w-100" id="3">JUN</div></div>
          <div class="col-1"><div class=" d-flex justify-content-center rounded w-100" id="4">JUL</div></div>
          <div class="col-1"><div class=" d-flex justify-content-center rounded w-100" id="5">AUG</div></div>
          <div class="col-1"><div class=" d-flex justify-content-center rounded w-100" id="6">SEP</div></div>
          <div class="col-1"><div class=" d-flex justify-content-center rounded w-100" id="7">OCT</div></div>
          <div class="col-1"><div class=" d-flex justify-content-center rounded w-100" id="8">NOV</div></div>
          <div class="col-1"><div class=" d-flex justify-content-center rounded w-100" id="9">DEC</div></div>
          <div class="col-1"><div class=" d-flex justify-content-center rounded w-100" id="10">JAN</div></div>
          <div class="col-1"><div class=" d-flex justify-content-center rounded w-100" id="11">FEB</div></div>
          <div class="col-1"><div class=" d-flex justify-content-center rounded w-100" id="12">MAR</div></div>
        </div>
        <div
          class="justify-content-center"
          style="visibility: hidden"
          id="payment"
        >
          <div class="row justify-content-center align-items-center g-2">
            <div class="col-6">
              <div class="label">no. of months for fee pement</div>
              <div>
                <input
                  type="number"
                  min="0"
                  step="1"
                  max="12"
                  name="months"
                  id="months"
                />
              </div>
            </div>

            <div class="col-6">
              <div><button class="bg-primary" id="pay_button">PAY</button></div>
            </div>
          </div>
        </div>
        <div id="paid" style="visibility: hidden">PAID</div>
      </div>
    </div>
  </body>
</html>
